display.size(640, 480)

config = {}

--[[
--  Blocks range
--    [0x1000, 0x0100[: floor
--    [0x0100, 0x0200[: ceiling
--    [0x0200, 0x0300[: solid walls
--    [0x0300, 0x0400[: transparent walls
--    [0x0400, 0x0500[: parallax
--
--  Blocks flags
--    0x000000: solid
--    0x010000: clipping
--    0x020000: action
--]]
config.grid = {
  {0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200},
  {0x0200, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x0200, 0x1000, 0x0200, 0x1000, 0x1000, 0x0200},
  {0x0200, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x0200, 0x1000, 0x0200, 0x1000, 0x1000, 0x0200},
  {0x0200, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x0200, 0x1300, 0x0200, 0x1000, 0x1000, 0x0200},
  {0x0200, 0x1000, 0x0202, 0x0202, 0x0202, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x0200},
  {0x0200, 0x1000, 0x0202, 0x1000, 0x2310, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x0200},
  {0x0200, 0x1000, 0x0202, 0x0202, 0x0202, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x0200},
  {0x0200, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x0200},
  {0x0200, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x0200},
  {0x0200, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x0200},
  {0x0200, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x0201, 0x0201, 0x0201, 0x1000, 0x1000, 0x1000, 0x0200},
  {0x0200, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x0301, 0x1000, 0x0201, 0x1000, 0x1000, 0x1000, 0x0200},
  {0x0200, 0x1000, 0x0200, 0x1300, 0x0200, 0x1000, 0x1000, 0x1000, 0x1000, 0x0201, 0x0201, 0x0201, 0x1000, 0x1000, 0x1000, 0x0200},
  {0x0200, 0x1000, 0x0200, 0x1000, 0x0200, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x0200},
  {0x0200, 0x1000, 0x0200, 0x1000, 0x0200, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x1000, 0x0200},
  {0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200, 0x0200}
}

config.block = 16
config.strip = 1
config.minimap = false
config.shadder = true
config.texture = true
config.fov = 45*math.pi/180

local metal_door = canvas.new("images/door-01.png")
local ghost = canvas.new("images/ghost.png")
local fireball = canvas.new("images/fireball.png")
local explosion = canvas.new("images/explosion.png")

config.textures = {
  [0x0200] = canvas.new("images/wall.png"),
  [0x0201] = canvas.new("images/wood.png"),
  [0x0202] = canvas.new("images/greystone.png"),
  
  [0x0300] = canvas.new("images/wall-hole.png"),
  [0x0301] = canvas.new("images/wood-hole.png"),
  [0x0302] = canvas.new("images/greystone-hole.png"),
  
  [0x0310] = metal_door:crop(0*32, 0, 32, 32), -- open/close door
  [0x0311] = metal_door:crop(1*32, 0, 32, 32),
  [0x0312] = metal_door:crop(2*32, 0, 32, 32),
  [0x0313] = metal_door:crop(3*32, 0, 32, 32),
  
  [0x0320] = ghost:crop(0*32, 0, 32, 32), -- ghost
  [0x0321] = ghost:crop(1*32, 0, 32, 32),
  [0x0322] = ghost:crop(2*32, 0, 32, 32),
  [0x0323] = ghost:crop(3*32, 0, 32, 32),
  
  -- [0x0330] = fireball
  
  -- [0x0350] = explosion

  [0x0400] = canvas.new("images/parallax.png")
}

for i=1,6*4 do
  local col = (i - 1)%6
  local row = math.floor((i - 1)/6)

  config.textures[0x0330 + i - 1] = fireball:crop(col*32, row*32, 32, 32)
end

for i=1,4*4 do
  local col = (i - 1)%4
  local row = math.floor((i - 1)/4)

  config.textures[0x0350 + i - 1] = explosion:crop(col*32, row*32, 32, 32)
end

config.animations = {
}

config.sprites = {
}

config.canvas2d = canvas.new(#config.grid[1]*config.block, #config.grid*config.block)
config.canvas3d = canvas.new(display.size())

dw, dh = display.size()
w2, h2 = config.canvas2d:size()
w3, h3 = config.canvas3d:size()

